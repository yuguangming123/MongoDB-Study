# MongoDB基础入门到高级进阶

## MongoDB快速上手

MongoDB用起来-快速上手&集群和安全系列
课程目标：

- 理部MongoDB的业务场景、熟悉MongoDB的简介、特点和体系结构、数据类型等。
- 能够在Windows和Linux下安装和启动MongoDB、图形化育理界面Compass的安装使用。
- 学握MongoDB基本常用命令实现数据的CRUD。
- 拿押MongoDB的索引类型、索引管理、执行计划。
- 皿用Spring Data MongoDB主成文章评论业务的开发。



## 1.MongoDB相关概念

### 1.1业务应用场景

传统的关系型数据库（如MySQL）,在数据操作的"三高"需港以及应对Web2.0的网站需求面前，显得力不从心

解释："三高"需求：

- High performance -对数据库高并发读写的需求。
- Huge Storage -对海量数据的高效率存储和访问的需求。
- High Scalability && High Availability-对数据库的高可扩展性和高可用性的需求。

**而MongoDB可应对"三高”需求。**

具体的应用场景如：

1）社交场景，使用MongoDB存储存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的 人、地点等功能。

2）游戏场景，使用MongoDB存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，方便查询、 高效率存储和访问。

3）物流场景，使用MongoDB存储订单信息，订单状态在运送过程中会不断更新，以MongoDB内嵌数组的形式 来存储，一次查询就能将订单所有的变更读取出来。

4）物联网场景，使用MongoDB存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多 维度的分析。

5）视频直播，使用MongoDB存储用户信息、点赞互动信息等。



这些应用场景中，数据操作方面的共同特点是：

(1)数据量大

(2)写入操作频繁(读写都很频繁)

(3)价值较低的数据，对事务性要求不高I

对于这样的数据，我们更适合使用MongoDB来实现数据的存储。

**什么时候选择MongoDB ?**

在架构选型上，除了上述的三个特点外，如果你还犹豫是否要选择它？可以考虑以下的一些问题:

应用不需要事务及复杂join支持

新应用，需求会变，数据模型无法确定，想快速迭代开发

应用需要2000-3000以上的读写QPS (更高也可以)

应用需要TB甚至PB级别数据存储

应用发展迅速，需要能快速水平扩展

应用要求存储的数据不丢失

应用需要99.999%高可用

应用需要大量的地理位置查询、文本查询

如果上述有1个符合，可以考虑MongoDB, 2个及以上的符合，选择MongoDB绝不会后悔。



思考：如果用MySQL呢？

答：相对MySQL,可以以更低的成本解决问题（包括学习、开发、运维等成本）

### 1.2MongoDB 简介

MongoDB是一个高性能、无模式的文档型数据库，当初的设计就JS用于简化开发和方便扩展，是NoSQL数 据库产品中的一种。理最像关系型数据库(MySQL)的非关系型数据库。

它支持的数摒结构非常松散，是一伸类似于JSON的格式叫BSON,所以它既可以存储上匕较复杂的数据类型，又相 当的灵活。

MongoDB中的记录是一个文档，它是一个由字段和值对(field:value)组成的数据结构.MongoDB文档类似于 JSON对象，即一个文档认为就是一个对象.字段的数据类型是字符型，它的值除了使用基本的一些类型外，还可 以包括其他文档、晋通数组和文档数组.



### 1.3体系结构

MySQL 和 MongoDB 对比

![img](https://aisearch.cdn.bcebos.com/pic_create/2025-12-21/18/f74e10a07fc9a618.jpg?x-bce-process=image/watermark,image_cGljX2NyZWF0ZS93YXRlcm1hcmsvaW1hZ2VfZWRpdF9haV9jcmVhdGVfd2F0ZXJtYXJrLnBuZw==,P_10)

| SQL术语/概念 | MongoDB术语/概念 | 解释/说明                            |
| ------------ | ---------------- | ------------------------------------ |
| database     | database         | 数据库                               |
| table        | collection       | 数据表/集合                          |
| row          | document         | 数据记录/文档                        |
| column       | field            | 数据字段/域                          |
| index        | index            | 索引                                 |
| table jions  |                  | 表连接，MongoDB不支持                |
|              | 嵌入文档         | MongoDB通过嵌入文档来代替多表连接    |
| primary key  | primary key      | 主键，MongoDB自动将_id字段设置为主键 |

 

### 1.4数据模型

MongoDB的最小存储单位就是文档(document)对象。文档(document)对象对应于关系型数据库的行。数据在 MongoDB中以BSON (Binary-JSON)文档的格式存储在磁盘上。

BSON (Binary Serialized Document Format)是一种类json的一种二进制形式的存储格式，简称Binary JSON。
BSON和JSON—样，支持内嵌的文档对象和数组对象，但是BSON有JSON没有的一些数据类型，如Date和 BinData 类型。

BSON采用了类似于C语言结构体的名称、对表示方法，支持内嵌的文档对象和数组对象，具有轻量性、可遍历 性、高效性的三个特点，可以有效描述非结构化数据和结构化数据。这种格式的优点是灵活性高，但它的缺点是空 间利用率不是很理想。

Bson中，除了基本的JSON类型：string,integer,boolean,double,null,arrayWobject, mongo还使用了特殊的数 据类型。这些类型包括date,object id,binary data,regular expression和code。每一驱动都以特定语言的方式 实现了这些类型，查看你的驱动的文档来获取详细信息。

**BSON数据类型参考列表:**

| 数据类型   | 描述                                                         | 举例                                         |
| ---------- | ------------------------------------------------------------ | -------------------------------------------- |
| 字符串     | UTF-8字符串都可以表示为字符串类型数据                        | {"x":"foobar"}                               |
| 对象id     | 对象id是文档的12字节的唯一ID                                 | {"x":objectId()}                             |
| 布尔值     | true、false                                                  | {"x":true}+                                  |
| 数组       | 值的集合或者列表可以表示乘数组                               | {"x":["a","b","c"]}                          |
| 32位整数   | 类型不可用，javascript仅支持64位浮点数，所以32位整数会被自动转换 | shell不支持该类型，shell默认转换为64位浮点数 |
| 64位整数   | shell中的数字就这种类型                                      | {"x":3.14159,"y":3}                          |
| null       | 表示空值或者未定义的对象                                     | {"x":null}                                   |
| undefined  | 文档中也可以使用未定义类型                                   | {"x":undefined}                              |
| 符号       | shell不支持，shell会将数据可中的符号类型的数据自动转换成字符串 |                                              |
| 正则表达式 | 文档可以包含正则表达式，采用javascript的正则表达式语法       | {"x":/foobar/i}                              |
| 代码       | 文档中还可以包含Javascript代码                               | {"x":function(){/* …… */}}                   |
| 二进制数据 | 二进制数据可以由任意字节的串组成，不过shell中无法使用        |                                              |

提示:
shell默认使用64位浮点型数值。{"x”: 3.14}或{"x”: 3}。对于整型值，可以使用Numberlnt (4字节符号整数)或 NumberLong (8字节符号整数),{"x":Numberlnt("3”)}{"x”:NumberLong("3")}



### 1.5MongoDB的特点

MongoDB主要有如下特点：

**(1)高性能：**

MongoDB提供高性能的数据持久性。特别是，对嵌入式数据模型的支持减少了数据库系统上的I/O活动。

索引支持更快的查询，并且可以包含来自嵌入式文档和数组的键。(文本索引解决搜索的需求、TTL索引解决历史数据自动过期的需求、地理位置索引可用于构建各种020应用)

mmapvl、wiredtiger、mongorocks (rocksdb)、in-memory 等多引擎支持满足各种场景需求。

Gridfs解决文件存储的需求。

**(2)高可用性：**

MongoDB的复制工具称为副本集(replica set),它可提供自动故障转移和数据冗余。

**(3)高扩展性：**

MongoDB提供了水平可扩展性作为其核心功能的一部分。

分片将数据分布在一组集群的机器上。(海量数据存储，服务能力水平扩展)

从3.4开始，MongoDB支持基于片键创建数据区域。在一个平衡的集群中，MongoDB将一个区域所覆盖的读写只 定向至U该区域内的那些片。

**(4)丰富的查询支持：**

MongoDB支持丰富的查询语言，支持读和写操作(CRUD)，比如数据聚合、文本搜索和地理空间查询等。

(5)其他特点：如无模式(动态模式)、灵活的文档模型



## 2.单机部署

第一步：下载安装包

MongoDB提供了可用于32位^ 64位钢的预编译二进制包 你可以从MongoDB官网下载安装，MongoDB预 编译二进制包下载地址：https://www.mongodb.eom/download-center#community I

根据上图所示下载zip包。

提示：版本的选择：

MongoDB的版本命名规范如：x.y.z;

y为奇数时表示当前版本为开肉版，如：1.5.2、4.1.13;

y为偶数时表示当前版本为稳定版，如：1.6.3、4.0.10;

z是修正版本号，数字越大越好。

详情：http://docs.mongodb.Org/manual/release-notes/#release-version-numbers

## 3.基本常用命令

### 3.1案例需求

存放文章评论的数据放在MongoDB中，数据结构参考如下：

数据库：articledb

| 专栏文章评论   | comment        |                  |                           |
| -------------- | -------------- | ---------------- | ------------------------- |
| 字段名称       | 字段含义       | 字段类型         | 备注                      |
| _id            | ID             | ObjectId或string | Mongo的主键的字段         |
| articleid      | 文章ID         | string           |                           |
| content        | 评论内容       | string           |                           |
| userid         | 评论人ID       | string           |                           |
| nickname       | 评论人昵称     | string           |                           |
| createdatetime | 评论的日期时间 | Date             |                           |
| likenum        | 点赞数         | Int32            |                           |
| state          | 状态           | string           | 0：不可见；1：可见        |
| parentid       | 上级ID         | string           | 如果为0表示文章的顶级评论 |



## 3.2数据库操作

### 3.2.1选择和创建数据库

- 选择和创建数据可语法格式：

  ~~~
  use 数据库名称
  ~~~

- 如果数据可不存在则会自动创建，例如，一下语句可以创建spitdb数据库：

  ~~~
  use articledb
  ~~~

- 查看有权限查看的左右数据库命令：

  ~~~
  show dbs
  或
  show databases
  ~~~

  > **注意：**在MongoDB中，集合只有在内容插入后才能创建，也就是说，创建集合（数据表）后要插入一个文档（记录），集合才会真正创建

- db#查看当前正在使用的数据库命令

  ~~~
  db
  ~~~

​		MongoDB中默认的数据库为test，如果你没有选择数据库，集合将存放在test数据库中。



另外，

数据库可以是满足以下条件的任意UTF-8的字符串。

- 不能是空字符（""）。
- 不能含“ ”空格、.、$、/、\和\0(空字符)。
- 应全部小写。
- 最多64字节

有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。

- **admin**：从权限角度看，这是“root”数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据可运行，比如列出所有数据库或者关闭关闭服务器。
- **local**：这个数据永远不会被复制，用于来存储限于本地单台服务器的任意集合。
- **config**：当MongoDB用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。